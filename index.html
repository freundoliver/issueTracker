<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="icon" href="res/icon.png">

    <title>Tracker Application</title>

    <link rel="stylesheet" type="text/css" href="css/style.css">
    <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">

    <!-- link stylesheet for datepicker -->
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">

    <!-- include jquery and jquery UI -->
    <script src="https://code.jquery.com/jquery-2.2.3.js" integrity="sha256-laXWtGydpwqJ8JA+X9x2miwmaiKhn8tVmOVEigRNtP4=" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/ui/1.11.4/jquery-ui.js" integrity="sha256-DI6NdAhhFRnO2k51mumYeDShet3I8AKCQf/tf7ARNhI=" crossorigin="anonymous"></script>

    <!-- include bootstrap main javascript -->
    <script src="js/bootstrap.min.js"></script>

    <!-- base UI js -->
    <script type="text/javascript">
        // -- define datepicker
        $(function() {
            $("#datepicker").datepicker();
        });

        // -- define slide toggle animation for  input fields -
        function toggleInputFields() {

            var wasToggled;

            if ($("#inputFields").is(":hidden")) {
                wasToggled = true;
            } else {
                wasToggled = false;
            }

            // toggle the div
            $("#inputFields").slideToggle();

            //change the arrow
            if (wasToggled) {
                // was toggled before and is now not toggled anymore -> show toggle button
                $(".glyphicon-menu-down").replaceWith('<span class="glyphicon glyphicon-menu-up" aria-hidden="true"></span>');
            } else {
                // was not toggled before and is now toggled -> show expand button
                $(".glyphicon-menu-up").replaceWith('<span class="glyphicon glyphicon-menu-down" aria-hidden="true"></span>');
            }
        };

        // - function for mobile: collapse when nav menu shown
        function mobileToggleContentBoxes() {

          var menuOpen;
          var inputFieldsVisible;
          var issueListVisible;

          // determine visibility of menu
          // visiblity is gathered before action, so its always the old state
          if ($("#navLinkList").is(":hidden")) {
              menuOpen = false;
          } else {
              menuOpen = true;
          }

          // determine state of input fields
          if ($("#inputFields").is(":hidden")) {
              inputFieldsVisible = false;
          } else {
              inputFieldsVisible = true;
          }

          //Determine state of isse list
          if ($("#issueList").is(":hidden")) {
              issueListVisible = false;
          } else {
              issueListVisible = true;
          }

          // -- toggle inputFields --
          var wasToggled;
          //if menu is open now, it will be collapsed. this means that the input fields must be extended aswell
          if (menuOpen == true && inputFieldsVisible == false) {
            $("#inputFields").toggle();
            wasToggled = true;
          }
          //if menu is closed now, it will be extended. this means that the input fields must be collapsed
          if (menuOpen == false && inputFieldsVisible == true){
            $("#inputFields").toggle();
            wasToggled = false;
          }

          // change the arrow of the input fields
          if (wasToggled) {
              // was toggled before and is now not toggled anymore -> show toggle button
              $(".glyphicon-menu-down").replaceWith('<span class="glyphicon glyphicon-menu-up" aria-hidden="true"></span>');
          } else {
              // was not toggled before and is now toggled -> show expand button
              $(".glyphicon-menu-up").replaceWith('<span class="glyphicon glyphicon-menu-down" aria-hidden="true"></span>');
          }

          // -- toggle Issue list --
          //if menu is open now, it will be collapsed. this means that the task list must be extended aswell
          if (menuOpen == true && issueListVisible == false) {
            $("#issueList").toggle();
          }
          //if menu is closed now, it will be extended. this means that the task list must be collapsed
          if (menuOpen == false && issueListVisible == true){
            $("#issueList").toggle();
          }

        };

    </script>

    <!-- storage js -->
    <script type="text/javascript">

      //if the website is loaded: read localStorage
      $( document ).ready(function() {
        localGetProjectID();

        localGetTasks();
      });

      function postNewProjectID() {
        //this function posts a new project id to the REST
        //expected results: OK, or Project ID allready there
        var url="http://zhaw-weng-api.herokuapp.com/api/projects/";
        var data='{ "title": "random" }';

        $.ajax({
            url: url,
            type: "POST",
            data: data,
            dataType: "json",
            success: function(result) {
                switch (result) {
                    case true:
                        processResponse(result);
                        break;
                    default:
                        alert("yay");
                }
            },
            error: function(xhr, ajaxOptions, thrownError) {
                alert(xhr.status);
                alert(thrownError);
            }
        })

        //jQuery.getJSON(url,data,success(xhr, ajaxOptions, thrownError));

      }

      /*function success(xhr, ajaxOptions, thrownError){
        alert(xhr.status);
        alert(thrownError);
      } */

      function localStoreProjectID(){
        //check if there was allready a project id
        var oldProjectID = localStorage.getItem("projectID");

        // new project id
        var projectID = $("#InputProjectName").val();

        //if project IDs are different: set new one and clear the old tasks!
        if (oldProjectID != projectID){
          localStorage.setItem("projectID", projectID);
          localStorage.removeItem("taskArray");

          location.reload();
        }

      }

      function localGetProjectID(){
        // Retrieve
        $("#InputProjectName").val(localStorage.getItem("projectID"));
      }

      function enterNewTask(){
        //check if projectID is set
        var projectID = localStorage.getItem("projectID");

        if (projectID != null){

        var taskName = $("#inputTaskName").val();
        var taskPrio = $("#inputPriority").val();
        var taskDueDate = $("#datepicker").val();
        var uuid = guid();

        var taskEntry = '<div class="row todo-list-element" id="'+uuid+'" > <!-- input checkbox: task done? --> <div class="col-md-1 center"> <form> <input type="checkbox" name="done" value="true" empty onclick="completeTask(\''+uuid+'\');"></form></div><!-- task name --><div class="col-md-8">'+taskName+'</div><!-- priority of task --><div class="col-md-1">'+taskPrio+'</div><!-- task due date --><div class="col-md-1">'+taskDueDate+'</div><!-- delete button --><div class="col-md-1 center"><img src="res/delete.png" alt="Delete item" onclick="deleteTask(\''+uuid+'\');"></div></div>';

        localStoreTask(taskEntry, uuid);

        $("#issueListContent").prepend(taskEntry);

        }
        else {
          alert ("Plese insert a Project-ID");
        }

      }

      function localStoreTask(taskEntry, uuid){

          //get task array
          var taskArray = JSON.parse(localStorage.getItem("taskArray"));

          if (taskArray != null){
            var taskArrayLength = taskArray.length;
            //this is the new task ID!
            taskArray[taskArrayLength] = new Array(2);
            taskArray[taskArrayLength][0] = uuid;
            taskArray[taskArrayLength][1] = taskEntry;

          }
          else{
            //create new array

            var taskArray = new Array();
            taskArray[0] = new Array(2);
            taskArray[0][0] = uuid;
            taskArray[0][1] = taskEntry;

          }

          //store again
          localStorage.setItem("taskArray", JSON.stringify(taskArray));
      }

      function localGetTasks(){

        //get task array
        var taskArray = JSON.parse(localStorage.getItem("taskArray"));

        jQuery.each(taskArray, function(index,item){
          if (item != null){
            $("#issueListContent").prepend(item[1]);
          }
        });

      }

      function guid() {
        function s4() {
          return Math.floor((1 + Math.random()) * 0x10000)
            .toString(16)
            .substring(1);
        }
        return s4() + s4() + '-' + s4() + '-' + s4() + '-' +
          s4() + '-' + s4() + s4() + s4();
      }

    </script>

    <!--scripts for issue actions-->
    <script type="text/javascript">
      function deleteTask(uuid){
        //delete div with uuid
        $('#'+uuid).remove();

        //delete from localstorage
        var taskArray = JSON.parse(localStorage.getItem("taskArray"));

        jQuery.each(taskArray, function(index,item){

          if (item!=null){
            if (item[0] == uuid){
              delete taskArray[index];
            }
          }
        });

        //store updated array again
        localStorage.setItem("taskArray", JSON.stringify(taskArray));

      }

      function completeTask(uuid){

        //get the div by uuid and replace it on the localcache
        var task = $('#'+uuid)[0].outerHTML;

        alert (task);

      }

    </script>


</head>


<body>

    <!-- container div, containing the whole content -->
    <div id="wrap" class="container">

        <!-- header -->
        <div class="page-header page-header-margin">
            <a href="#" class="pull-left"><img src="res/logo.png"></a>
            <div class="title-text">
                <h1>Issue Tracker<small> - Track your most important tasks </small> </h1>
            </div>
        </div>

        <!-- navbar -->
        <nav class="navbar navbar-default">
            <div class="container-fluid">
                <!-- Brand and toggle get grouped for better mobile display -->
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navLinkList" aria-expanded="false" id="menuBar" onclick="mobileToggleContentBoxes();">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                </div>

                <!-- Collect the nav links, forms, and other content for toggling -->
                <div class="collapse navbar-collapse" id="navLinkList">
                    <ul class="nav navbar-nav navbar-center">
                        <li class="active"><a href="#">Home<span class="sr-only">(current)</span></a></li>
                        <li><a href="about.html">About</a></li>
                        <li><a href="contact.html">Contact</a></li>
                    </ul>
                </div>
                <!-- /.navbar-collapse -->
            </div>
            <!-- /.container-fluid -->
        </nav>

        <!-- project switcher -->
        <div class="panel panel-default">
            <div class="panel-heading task-insert-header">

                <div class="row">
                    <div class="col-md-1 align-center">
                        <b> Project</b>
                    </div>
                    <div class="col-md-4">
                        <input type="text" class="form-control" id="InputProjectName" placeholder="enter Project ID">
                    </div>
                    <div class="col-md-4">
                        <button type="submit" class="btn btn-default" onclick="localStoreProjectID();">Submit Project</button>
                    </div>
                </div>
            </div>

        </div>

        <!-- input form -->
        <div class="panel panel-default">
            <div class="panel-heading task-insert-header" onclick="toggleInputFields();">

                <div class="row">
                    <div class="col-md-11">
                        <b> Insert a new task</b>
                    </div>
                    <div class="col-md-1 center">
                        <button type="button" class="btn btn-default btn-xs" aria-label="Expand">
                            <span class="glyphicon glyphicon-menu-up" aria-hidden="true"></span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- include in a panel -->
            <div class="panel-body" id="inputFields">

                <form>
                    <div class="form-group">

                        <div class="col-md-12">

                            <div class="col-md-8">
                                <div class="form-group row">
                                    <label for="InputTaskName">Task name</label>
                                    <input type="text" class="form-control" id="inputTaskName" placeholder="enter your task">
                                </div>
                            </div>
                        </div>

                        <div class="col-md-12">

                            <div class="form-group row">

                                <div class="col-md-2">
                                    <label for="InputPriority">Priority</label>
                                    <select class="form-control" id="inputPriority">
                                        <option>1 - High</option>
                                        <option>2 - Med.</option>
                                        <option>3 - Low</option>
                                    </select>
                                </div>

                                <div class="col-md-2">
                                    <label for="datepicker">Due date</label>
                                    <input type="text" class="form-control" id="datepicker">
                                </div>
                            </div>
                        </div>

                        <div class="col-md-12">
                            <div class="col-md-1">
                                <div class="form-group row">
                                    <button type="button" class="btn btn-default" onclick="enterNewTask()">Submit</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>

            </div>
        </div>

        <!--task list header -->
        <div class="panel panel-default no-bottom-margin">
            <!-- header of tasks -->
            <div class="panel-heading task-list-header">
                <div class="row">

                    <div class="col-md-1 center">
                        <b>Done</b>
                    </div>

                    <div class="col-md-8">
                        <b>Task Name</b>
                    </div>

                    <div class="col-md-1">
                        <b>Prio</b>
                    </div>

                    <div class="col-md-1 noWrap">
                        <b>Due Date</b>
                    </div>

                    <div class="col-md-1 center">
                        <b>Delete</b>
                    </div>
                </div>
            </div>
        </div>

        <!-- task list -->
        <div class="panel panel-default task-list" id="issueList">

            <!-- task content -->
            <div class="panel-body no-top-margin" id="issueListContent">

                <!-- example of task-->
                <!-- <div class="row todo-list-element"> -->
                    <!-- input checkbox: task done? -->
                    <!--<div class="col-md-1 center">
                        <!--<form>
                            <!--<input type="checkbox" name "done">
                        <!--</form>
                    </div>
                    <!-- task name -->
                    <!--<div class="col-md-8">
                        Blabla bla
                    </div>
                    <!-- priority of task -->
                    <!--<div class="col-md-1">
                        1 - High
                    </div>
                    <!-- task due date -->
                    <!--<div class="col-md-1">
                        20.03.2016
                    </div>
                    <!-- delete button -->
                    <!--<div class="col-md-1 center">
                        <img src="res/delete.png" alt="Delete item">
                    </div>
                </div> -->

            </div>

        </div>

        <!-- footer -->
        <div id="footer">
            <div class="container">
                <div class="center center-vertically">
                    &copy; 2016 Trackersoft GmbH |
                    <a href="tos.html" class="a"> Terms of Use </a>
                </div>
            </div>
        </div>

    </div>

</body>

</html>
